{"version":3,"sources":["server.ts"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["/**\n * Module dependencies.\n */\nimport * as express from 'express';\nimport * as compression from 'compression';  // compresses requests\nimport * as session from 'express-session';\nimport * as bodyParser from 'body-parser';\nimport * as logger from 'morgan';\nimport * as errorHandler from 'errorhandler';\nimport * as lusca from 'lusca';\nimport * as dotenv from 'dotenv';\nimport * as mongo from 'connect-mongo';\nimport * as flash from 'express-flash';\nimport * as path from 'path';\nimport * as mongoose from 'mongoose';\nimport * as passport from 'passport';\nimport * as socketio from 'socket.io';\nimport * as http from 'http';\nimport * as twilio from 'twilio';\nimport twilioConfig from './config/twilio';\n\nimport expressValidator = require('express-validator');\nrequire('./common/ArrayExtensions');\nrequire('./common/StringExtensions');\n\n\nconst MongoStore = mongo(session);\n\n/**\n * Load environment variables from .env file, where API keys and passwords are configured.\n */\ndotenv.config({ path: path.join(__dirname, '.env') });\n\n\n/**\n * Controllers (route handlers).\n */\nimport * as homeController from './controllers/home';\nimport * as userController from './controllers/user';\nimport * as contactController from './controllers/contact';\nimport * as registrationController from './controllers/register';\nimport * as eventController from './controllers/event';\nimport * as resultsController from './controllers/results';\n\n/**\n * API keys and Passport configuration.\n */\nimport * as passportConfig from './config/passport';\n\n/**\n * Create Express server.\n */\nconst app = express();\n\nconst httpServer = http.createServer(app);\nconst io = socketio(httpServer);\n\nio.on('connection', (socket: SocketIO.Socket) => {\n    console.log('a user connected');\n});\n\n/**\n * Connect to MongoDB.\n */\n// mongoose.Promise = global.Promise;\nmongoose.connect(process.env.MONGODB_URI || process.env.MONGOLAB_URI);\n\nmongoose.connection.on('error', () => {\n    console.log('MongoDB connection error. Please make sure MongoDB is running.');\n    process.exit();\n});\n\n\n\n/**\n * Express configuration.\n */\napp.set('port', process.env.PORT || 3000);\napp.set('views', path.join(__dirname, './views'));\napp.set('view engine', 'pug');\napp.use(compression());\napp.use(logger('dev'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(expressValidator());\napp.use(session({\n    resave: true,\n    saveUninitialized: true,\n    secret: process.env.SESSION_SECRET,\n    store: new MongoStore({\n        url: process.env.MONGODB_URI || process.env.MONGOLAB_URI,\n        autoReconnect: true\n    })\n}));\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(flash());\napp.use(lusca.xframe('SAMEORIGIN'));\napp.use(lusca.xssProtection(true));\napp.use((req, res, next) => {\n    res.locals.user = req.user;\n    next();\n});\napp.use((req, res, next) => {\n    // After successful login, redirect back to the intended page\n    if (!req.user &&\n        req.path !== '/login' &&\n        req.path !== '/signup' &&\n        !req.path.match(/^\\/auth/) &&\n        !req.path.match(/\\./)) {\n        req.session.returnTo = req.path;\n    } else if (req.user &&\n        req.path == '/account') {\n        req.session.returnTo = req.path;\n    }\n    next();\n});\napp.use(express.static(path.join(__dirname, 'public'), { maxAge: 31557600000 }));\n\nio.on('connection', (socket) => {\n    console.log('a user connected');\n});\n\n/**\n * Boilerplate app routes.\n */\napp.get('/login', userController.getLogin);\napp.post('/login', userController.postLogin);\napp.get('/logout', userController.logout);\napp.get('/forgot', userController.getForgot);\napp.post('/forgot', userController.postForgot);\napp.get('/reset/:token', userController.getReset);\napp.post('/reset/:token', userController.postReset);\napp.get('/signup', userController.getSignup);\napp.post('/signup', userController.postSignup);\napp.get('/contact', contactController.getContact);\napp.post('/contact', contactController.postContact);\napp.get('/account', passportConfig.isAuthenticated, userController.getAccount);\napp.get('/account/unlink/:provider', passportConfig.isAuthenticated, userController.getOauthUnlink);\napp.post('/account/profile', passportConfig.isAuthenticated, userController.postUpdateProfile);\napp.post('/account/password', passportConfig.isAuthenticated, userController.postUpdatePassword);\napp.post('/account/delete', passportConfig.isAuthenticated, userController.postDeleteAccount);\n\n/**\n * Primary app routes.\n */\napp.get('/', homeController.index);\napp.get('/event/:eventId/results', resultsController.index);\napp.get('/event/register', passportConfig.isAuthenticated, registrationController.index);\n\n/**\n * Api routes.\n */\napp.get('/api/events', passportConfig.isAuthenticated, eventController.getEvents);\napp.get('/api/event/:eventId', eventController.getEvent);\napp.post('/api/event/', eventController.saveEvent);\napp.delete('/api/event/:eventId', passportConfig.isAuthenticated, eventController.deleteEvent);\napp.get('/api/event/:eventId/registrations', passportConfig.isAuthenticated);\napp.put('/api/event/:eventId/registration', passportConfig.isAuthenticated);\n\napp.post('/api/vote/sms', twilio.webhook(), eventController.voteSMS);\n\n/**\n * Error Handler. Provides full stack - remove for production\n */\napp.use(errorHandler());\n\n/**\n * Start Express server.\n */\napp.listen(app.get('port'), () => {\n    console.log(('  App is running at http://localhost:%d in %s mode'), app.get('port'), app.get('env'));\n    console.log('  Press CTRL-C to stop\\n');\n});\n\nmodule.exports = app;"]}